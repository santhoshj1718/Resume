<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Application Form</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: url(./back.jpg) no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
            font-family: sans-serif;
        }

        .box {
            width: 400px;
            background: #f5f5f5;
            color: red;
            top: 50%;
            left: 50%;
            position: absolute;
            transform: translate(-50%, -50%);
            box-sizing: border-box;
            padding: 70px 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
        }

        .user {
            width: 100px;
            height: 100px;
            position: absolute;
            top: -50px;
            left: calc(50% - 50px);
            border-radius: 50%;
            background: #fff;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        h1 {
            margin: 0;
            padding: 0 0 20px;
            text-align: center;
            font-size: 22px;
            color: black;
        }

        p {
            color: #f49126;
            margin: 0;
            padding: 0;
            font-weight: bold;
        }

        input {
            width: 100%;
            margin-bottom: 20px;
        }

        input[type="text"],
        input[type="email"],
        input[type="file"],
        input[type="tel"] {
            border: none;
            border-bottom: 1px solid #673ab7;
            background: transparent;
            outline: none;
            height: 40px;
            color: #673ab7;
            font-size: 16px;
        }

        input[type="submit"] {
            border: none;
            outline: none;
            height: 40px;
            background: #2196f3;
            color: #fff;
            font-size: 18px;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s;
        }

        input[type="submit"]:hover {
            background: #0097a7;
        }

        .error {
            color: red;
            font-size: 12px;
            margin-top: -15px;
            margin-bottom: 15px;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 10px 0;
            color: #2196f3;
        }
    </style>
</head>
<body>
    <div class="box">
        <img src="./user.png" class="user">
        <h1>Job Application Form</h1>

        <form id="application-form" enctype="multipart/form-data">
            <p>Username</p>
            <input type="text" name="uname1" id="username" placeholder="Enter Username" required>
            <div id="username-error" class="error"></div>

            <p>Email</p>
            <input type="email" name="email" id="email" placeholder="Enter Email Id" required>
            <div id="email-error" class="error"></div>

            <p>Phone Number</p>
            <input type="tel" name="phone" id="phone" placeholder="Enter Phone Number" required pattern="^\d{10}$" title="Please enter exactly 10 digits">
            <div id="phone-error" class="error"></div>

            <p>Upload Resume (PDF or Word)</p>
            <input type="file" id="resume" name="resume" accept=".pdf,.doc,.docx" required>
            <div id="resume-error" class="error"></div>
            
            <div id="loading" class="loading">
                <i class="fas fa-spinner fa-spin"></i> Processing your resume...
            </div>

            <input type="submit" value="Apply Now">
        </form>
    </div>

    <!-- Load PDF.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <!-- Load Font Awesome for loading spinner -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>

    <script>
        document.getElementById('application-form').addEventListener('submit', async function (event) {
            event.preventDefault();
            
            // Reset error messages
            document.querySelectorAll('.error').forEach(el => el.textContent = '');
            
            // Get form values
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const resume = document.getElementById('resume').files[0];
            
            // Validation flags
            let isValid = true;
            
            // Username validation
            if (username.length < 3) {
                document.getElementById('username-error').textContent = 'Username must be at least 3 characters';
                isValid = false;
            }
            
            // Email validation
            const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
            if (!emailPattern.test(email)) {
                document.getElementById('email-error').textContent = 'Please enter a valid email address';
                isValid = false;
            }
            
            // Phone validation
            const phonePattern = /^\d{10}$/;
            if (!phonePattern.test(phone)) {
                document.getElementById('phone-error').textContent = 'Please enter a valid 10-digit phone number';
                isValid = false;
            }
            
            // Resume validation
            if (!resume) {
                document.getElementById('resume-error').textContent = 'Please upload your resume';
                isValid = false;
            }
            
            if (!isValid) return;
            
            // Show loading indicator
            document.getElementById('loading').style.display = 'block';
            
            try {
                // Store user data in localStorage
                localStorage.setItem('username', username);
                localStorage.setItem('email', email);
                localStorage.setItem('phone', phone);
                
                let text = '';
                
                // Process PDF
                if (resume.name.endsWith('.pdf')) {
                    text = await extractTextFromPDF(resume);
                } 
                // Process Word (simulated - in real app use mammoth.js)
                else if (resume.name.endsWith('.doc') || resume.name.endsWith('.docx')) {
                    text = await simulateWordProcessing(resume);
                }
                
                const skills = extractSkills(text);
                localStorage.setItem('skills', JSON.stringify(skills));
                
                // Redirect to job listing page
                window.location.href = "job-listing.html";
                
            } catch (error) {
                console.error("Error processing resume:", error);
                document.getElementById('resume-error').textContent = 'Error processing your resume. Please try again.';
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        });
        
        async function extractTextFromPDF(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const typedarray = new Uint8Array(event.target.result);
                    
                    // Initialize PDF.js
                    pdfjsLib.getDocument(typedarray).promise.then(function(pdf) {
                        let totalText = "";
                        const pagePromises = [];
                        
                        for (let i = 1; i <= pdf.numPages; i++) {
                            pagePromises.push(
                                pdf.getPage(i).then(function(page) {
                                    return page.getTextContent().then(function(textContent) {
                                        const pageText = textContent.items.map(item => item.str).join(" ");
                                        totalText += pageText + " ";
                                    });
                                })
                            );
                        }
                        
                        Promise.all(pagePromises).then(() => resolve(totalText));
                    }).catch(reject);
                };
                reader.onerror = () => reject(new Error('Error reading file'));
                reader.readAsArrayBuffer(file);
            });
        }
        
        function simulateWordProcessing(file) {
            return new Promise((resolve) => {
                // Simulate processing delay
                setTimeout(() => {
                    // Simulated resume text with skills
                    const simulatedText = `
                        John Doe's Resume
                        SKILLS:
                        - JavaScript, React, Node.js
                        - Python, Django
                        - HTML5, CSS3
                        - Git, Docker
                        
                        EXPERIENCE:
                        - 5 years as Full Stack Developer
                        - Built web applications using MERN stack
                        
                        EDUCATION:
                        - B.Tech in Computer Science
                    `;
                    resolve(simulatedText);
                }, 1500);
            });
        }
        
        function extractSkills(text) {
            // Comprehensive list of technical skills to look for
            const allSkills = [
                'JavaScript', 'Python', 'Java', 'C', 'C++', 'C#', 'PHP', 'Ruby',
                'HTML', 'CSS', 'React', 'Angular', 'Vue', 'Node.js', 'Express',
                'Django', 'Flask', 'Spring', 'Laravel', 'Ruby on Rails',
                'SQL', 'MySQL', 'PostgreSQL', 'MongoDB', 'Firebase',
                'Git', 'Docker', 'Kubernetes', 'AWS', 'Azure', 'Google Cloud',
                'REST API', 'GraphQL', 'Webpack', 'Babel', 'TypeScript',
                'Machine Learning', 'Data Science', 'Artificial Intelligence',
                'Linux', 'Windows', 'MacOS', 'Android', 'iOS'
            ];
            
            // Convert text to lowercase for case-insensitive matching
            const lowerText = text.toLowerCase();
            
            // Find skills mentioned in the resume
            const foundSkills = allSkills.filter(skill => 
                lowerText.includes(skill.toLowerCase())
            );
            
            // If no skills found, return some default skills
            return foundSkills.length > 0 ? foundSkills : ['General IT', 'Problem Solving'];
        }
    </script>
</body>
</html>
